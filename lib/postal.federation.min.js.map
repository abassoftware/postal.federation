{"version":3,"sources":["postal.federation.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_1__","__WEBPACK_EXTERNAL_MODULE_2__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","processSignalQ","args","fedx","signalReady","apply","processOutboundQ","send","processInboundQ","msg","onFederatedMsg","Object","defineProperty","value","_lodash","_lodash2","_postal","_postal2","_packingSlips","_state","_handlers","_filters","_filters2","_FederationClient","_FederationClient2","FederationClient","packingSlips","handlers","clients","state","_clients","transports","_transports","filters","addFilter","removeFilter","canSendRemote","channel","topic","matchesFilter","configure","getPackingSlip","sendMessage","envelope","_ready","each","transport","_outboundQueue","push","arguments","disconnect","_getTransports","reduce","memo","name","target","callback","_signalQueue","length","NO_OP","targets","addWireTap","data","subscribe","configuration","SYSTEM_CHANNEL","shift","_inboundQueue","undefined","instanceId","createUUID","s","hexDigits","i","substr","Math","floor","random","join","_id","_oldId","publish","oldId","newId","type","prototype","hasOwnProperty","Array","slice","ping","timeStamp","Date","ticket","pong","pingData","message","env","bundle","cfg","filterMode","Error","_config","defaults","_defaults","options","trans","t","doNotNotify","enabled","filterDirection","packingSlip","federation.ping","source","setInstanceId","handshakeComplete","sendPong","sendBundle","federation.pong","pings","includes","remoteId","localId","federation.disconnect","without","transportName","federation.message","lastSender","federation.bundle","slip","extend","isArray","filter","direction","dir","include","channelPresent","topicMatch","some","binding","resolver","compare","blacklisting","in","out","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","origPackingSlip","slips","originId","clone","knownIds","concat","shouldProcess","ctrProps","FedXClient","create"],"mappings":";;;;;;;CAOA,SAA2CA,EAAMC,GAC1B,gBAAZC,UAA0C,gBAAXC,QACxCA,OAAOD,QAAUD,EAAQG,QAAQ,UAAWA,QAAQ,WAC3B,kBAAXC,SAAyBA,OAAOC,IAC9CD,QAAQ,SAAU,UAAWJ,GACH,gBAAZC,SACdA,QAAoB,WAAID,EAAQG,QAAQ,UAAWA,QAAQ,WAE3DJ,EAAiB,WAAIC,EAAQD,EAAQ,EAAGA,EAAa,UACpDO,KAAM,SAASC,EAA+BC,GACjD,MAAgB,UAAUC,GAKhB,QAASC,GAAoBC,GAG5B,GAAGC,EAAiBD,GACnB,MAAOC,GAAiBD,GAAUV,OAGnC,IAAIC,GAASU,EAAiBD,IAC7BV,WACAY,GAAIF,EACJG,QAAQ,EAUT,OANAL,GAAQE,GAAUI,KAAKb,EAAOD,QAASC,EAAQA,EAAOD,QAASS,GAG/DR,EAAOY,QAAS,EAGTZ,EAAOD,QAvBf,GAAIW,KAqCJ,OATAF,GAAoBM,EAAIP,EAGxBC,EAAoBO,EAAIL,EAGxBF,EAAoBQ,EAAI,GAGjBR,EAAoB,KAK/B,SAAUR,EAAQD,EAASS,GAOhC,QAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GAuGzF,QAASG,GAAeC,GACvBC,EAAKC,YAAYC,MAAMrB,KAAMkB,GAG9B,QAASI,GAAiBJ,GACzBC,EAAKI,KAAKF,MAAMrB,KAAMkB,GAGvB,QAASM,GAAgBC,GACxBN,EAAKO,eAAejB,KAAKT,KAAMyB,GArHhCE,OAAOC,eAAejC,EAAS,cAC9BkC,OAAO,GAMR,IAAIC,GAAU1B,EAAoB,GAE9B2B,EAAWlB,EAAuBiB,GAElCE,EAAU5B,EAAoB,GAE9B6B,EAAWpB,EAAuBmB,EAEtC5B,GAAoB,EAEpB,IAAI8B,GAAgB9B,EAAoB,GAEpC+B,EAAS/B,EAAoB,GAE7BgC,EAAYhC,EAAoB,GAEhCiC,EAAWjC,EAAoB,GAE/BkC,EAAYzB,EAAuBwB,GAEnCE,EAAoBnC,EAAoB,GAExCoC,EAAqB3B,EAAuB0B,GAE5CpB,EAAOc,EAAS,WAAWd,MAC9BsB,iBAAkBD,EAAmB,WACrCE,aAAcR,EAAcQ,aAC5BC,SAAUP,EAAUO,SACpBC,QAAST,EAAOU,MAAMC,SACtBC,WAAYZ,EAAOU,MAAMG,YACzBC,QAASX,EAAU,WACnBY,UAAWb,EAASa,UACpBC,aAAcd,EAASc,aACvBC,cAAe,SAAuBC,EAASC,GAC9C,OAAO,EAAIjB,EAASkB,eAAeF,EAASC,EAAO,QAEpDE,UAAWrB,EAAOqB,UAClBC,eAAgBvB,EAAcuB,eAC9B/B,eAAgBU,EAAUV,eAC1BgC,YAAa,SAAqBC,GACjC,MAAKxB,GAAOU,MAAMe,WAIlB7B,GAAS,WAAW8B,KAAK7D,KAAK+C,WAAY,SAAUe,GACnDA,EAAUJ,YAAYC,SAJtBxB,GAAOU,MAAMkB,eAAeC,KAAKC,YAOnCC,WAAY/B,EAAO+B,WACnBC,eAAgB,WACf,MAAOpC,GAAS,WAAWqC,OAAOpE,KAAK+C,WAAY,SAAUsB,EAAMP,EAAWQ,GAE7E,MADAD,GAAKC,IAAQ,EACND,QAUTjD,YAAa,SAAqB0C,EAAWS,EAAQC,GACpD,IAAKrC,EAAOU,MAAMe,OAEjB,WADAzB,GAAOU,MAAM4B,aAAaT,KAAKC,UAGhC,IAAIlB,GAAa/C,KAAKmE,gBACtB,QAAQF,UAAUS,QACjB,IAAK,GACqB,kBAAdZ,GACVU,EAAWV,EACoB,gBAAdA,KACjBf,KACAA,EAAWe,GAAa9D,KAAK+C,WAAWe,GACxCU,EAAWrC,EAAOwC,MAEnB,MACD,KAAK,GACqB,gBAAdb,IACVf,KACAA,EAAWe,GAAa9D,KAAK+C,WAAWe,IAExCf,EAAae,EAEdU,EAAWD,GAAUpC,EAAOwC,KAC5B,MACD,KAAK,GACJ5B,KACAA,EAAWe,IAAcS,GAG3BxC,EAAS,WAAW8B,KAAKd,EAAY,SAAU6B,EAASN,GACvDM,EAA6B,iBAAZA,MAA6BA,EAC9C5E,KAAK+C,WAAWuB,GAAMlD,YAAYwD,EAASJ,IACzCxE,OAILL,GAAQ,WAAawB,EAcrBc,EAAS,WAAW4C,WAAW,SAAUC,EAAMnB,GAC1CxC,EAAKiC,cAAcO,EAASN,QAASM,EAASL,QACjDnC,EAAKuC,YAAYC,KAInB1B,EAAS,WAAW8C,WACnB1B,QAASpB,EAAS,WAAW+C,cAAcC,eAC3C3B,MAAO,qBACPkB,SAAU,WAET,IADArC,EAAOU,MAAMe,QAAS,EACfzB,EAAOU,MAAM4B,aAAaC,QAChCzD,EAAekB,EAAOU,MAAM4B,aAAaS,QAE1C,MAAO/C,EAAOU,MAAMkB,eAAeW,QAClCpD,EAAiBa,EAAOU,MAAMkB,eAAemB,QAE9C,MAAO/C,EAAOU,MAAMsC,cAAcT,QACjClD,EAAgBW,EAAOU,MAAMsC,cAAcD,YAKLE,SAArCnD,EAAS,WAAWoD,eACvBlD,EAAOU,MAAMe,QAAS,GAEvBhE,EAAOD,QAAUA,EAAQ,YAIpB,SAAUC,EAAQD,GAEvBC,EAAOD,QAAUM,GAIZ,SAAUL,EAAQD,GAEvBC,EAAOD,QAAUO,GAIZ,SAAUN,EAAQD,EAASS,GAIhC,QAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GAEzF,GAAIkB,GAAU5B,EAAoB,GAE9B6B,EAAWpB,EAAuBmB,EAEjCC,GAAS,WAAWqD,aACxBrD,EAAS,WAAWqD,WAAa,WAGhC,IAAK,GAFDC,MACAC,EAAY,mBACPC,EAAI,EAAGA,EAAI,GAAIA,IACvBF,EAAEE,GAAKD,EAAUE,OAAOC,KAAKC,MAAsB,GAAhBD,KAAKE,UAAkB,EAO3D,OALAN,GAAE,IAAM,IAERA,EAAE,IAAMC,EAAUE,OAAe,EAARH,EAAE,IAAY,EAAK,GAE5CA,EAAE,GAAKA,EAAE,IAAMA,EAAE,IAAMA,EAAE,IAAM,IACxBA,EAAEO,KAAK,MAGX7D,EAAS,WAAWoD,aACxBpD,EAAS,WAAWoD,WAAa,WAChC,GAAIU,GAAMX,OACNY,EAASZ,MACb,OAAO,UAAU7E,GAahB,MAZIA,KACHyF,EAASD,EACTA,EAAMxF,EACN0B,EAAS,WAAWgE,SACnB5C,QAASpB,EAAS,WAAW+C,cAAcC,eAC3C3B,MAAO,qBACPwB,MACCoB,MAAOF,EACPG,MAAOJ,MAIHA,QAOL,SAAUnG,EAAQD,EAASS,GAQhC,QAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GAMzF,QAAS2C,GAAe2C,GACvB,GAAIzE,OAAO0E,UAAUC,eAAe7F,KAAKiC,EAAc0D,GACtD,MAAO1D,GAAa0D,GAAM/E,MAAMrB,KAAMuG,MAAMF,UAAUG,MAAM/F,KAAKwD,UAAW,IAd9EtC,OAAOC,eAAejC,EAAS,cAC9BkC,OAAO,IAERlC,EAAQ8D,eAAiBA,CAKzB,IAAIzB,GAAU5B,EAAoB,GAE9B6B,EAAWpB,EAAuBmB,GAQlCU,GACH+D,KAAM,WACL,OACCL,KAAM,kBACNf,WAAYpD,EAAS,WAAWoD,aAChCqB,UAAW,GAAIC,MACfC,OAAQ3E,EAAS,WAAWqD,eAG9BuB,KAAM,SAAcJ,GACnB,OACCL,KAAM,kBACNf,WAAYpD,EAAS,WAAWoD,aAChCqB,UAAW,GAAIC,MACfG,UACCzB,WAAYoB,EAAKpB,WACjBqB,UAAWD,EAAKC,UAChBE,OAAQH,EAAKG,UAIhBG,QAAS,SAAiBC,GACzB,OACCZ,KAAM,qBACNf,WAAYpD,EAAS,WAAWoD,aAChCqB,UAAW,GAAIC,MACfhD,SAAUqD,IAGZ9C,WAAY,WACX,OACCkC,KAAM,wBACNf,WAAYpD,EAAS,WAAWoD,aAChCqB,UAAW,GAAIC,QAGjBM,OAAQ,SAAgBvE,GACvB,OACC0D,KAAM,oBACNf,WAAYpD,EAAS,WAAWoD,aAChCqB,UAAW,GAAIC,MACfjE,aAAcA,IAIjB/C,GAAQ+C,aAAeA,GAIlB,SAAU9C,EAAQD,EAASS,GAShC,QAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GA2BzF,QAAS0C,GAAU0D,GAClB,GAAIA,GAAOA,EAAIC,YAAiC,cAAnBD,EAAIC,YAAiD,cAAnBD,EAAIC,WAClE,KAAM,IAAIC,OAAM,6DAKjB,OAHIF,KACHrE,EAAMwE,QAAUtF,EAAS,WAAWuF,SAASJ,EAAKK,IAE5C1E,EAAMwE,QAGd,QAASnD,GAAWsD,GACnBA,EAAUA,KACV,IAAIC,GAAQ5E,EAAMG,WACdwE,GAAQ1D,YACX2D,KACAA,EAAMD,EAAQ1D,WAAajB,EAAMG,YAAYwE,EAAQ1D,YAEtD/B,EAAS,WAAW8B,KAAK4D,EAAO,SAAUC,GACzCA,EAAExD,YACDK,OAAQiD,EAAQjD,OAChBc,WAAYmC,EAAQnC,WACpBsC,cAAeH,EAAQG,gBAvD1BhG,OAAOC,eAAejC,EAAS,cAC9BkC,OAAO,IAERlC,EAAQ6D,UAAYA,EACpB7D,EAAQuE,WAAaA,CAKrB,IAAIpC,GAAU1B,EAAoB,GAE9B2B,EAAWlB,EAAuBiB,GAElCyF,GACHK,SAAS,EACTT,WAAY,YACZU,gBAAiB,QAGdlD,EAAQ,YAEZhF,GAAQgF,MAAQA,CAChB,IAAI9B,IACHC,YACAE,eACAY,QAAQ,EACRuB,iBACApB,kBACAU,gBACA4C,QAASE,EAGV5H,GAAQkD,MAAQA,GA8BX,SAAUjD,EAAQD,EAASS,GAQhC,QAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GA2EzF,QAASY,GAAeoD,GACvB,IAAK3C,EAAOU,MAAMe,OAEjB,WADAzB,GAAOU,MAAMsC,cAAcnB,KAAKc,EAGjC,KAAInD,OAAO0E,UAAUC,eAAe7F,KAAKkC,EAAUmC,EAAKgD,YAAY1B,MAGnE,KAAM,IAAIgB,OAAM,0DAA4DtC,EAAKgD,YAAY1B,KAAO,KAFpGzD,GAASmC,EAAKgD,YAAY1B,MAAMtB,GAvFlCnD,OAAOC,eAAejC,EAAS,cAC9BkC,OAAO,IAERlC,EAAQ+B,eAAiBA,CAKzB,IAAIQ,GAAgB9B,EAAoB,GAEpC+B,EAAS/B,EAAoB,GAE7BiC,EAAWjC,EAAoB,GAE/B4B,EAAU5B,EAAoB,GAE9B6B,EAAWpB,EAAuBmB,GAElCF,EAAU1B,EAAoB,GAE9B2B,EAAWlB,EAAuBiB,GAElCa,GACHoF,kBAAmB,SAAwBjD,GAC1CA,EAAKkD,OAAOC,cAAcnD,EAAKgD,YAAYzC,YACvCP,EAAKkD,OAAOE,kBACfpD,EAAKkD,OAAOG,SAASrD,EAAKgD,aAE1BhD,EAAKkD,OAAOI,aAAY,EAAIlG,EAAcuB,gBAAgB,OAAQqB,EAAKgD,cAAc,EAAI5F,EAAcuB,gBAAgB,WAGzH4E,kBAAmB,SAAwBvD,GAC1CA,EAAKkD,OAAOE,mBAAoB,EAChCpD,EAAKkD,OAAOC,cAAcnD,EAAKgD,YAAYzC,YACvCP,EAAKkD,OAAOM,MAAMxD,EAAKgD,YAAYhB,SAASF,UAC/C9B,EAAKkD,OAAOM,MAAMxD,EAAKgD,YAAYhB,SAASF,QAAQpC,UACnDoC,OAAQ9B,EAAKgD,YAAYhB,SAASF,OAClCvB,WAAYP,EAAKgD,YAAYzC,WAC7B2C,OAAQlD,EAAKkD,SAEdlD,EAAKkD,OAAOM,MAAMxD,EAAKgD,YAAYhB,SAASF,QAAUxB,QAElDrD,EAAS,WAAWwG,SAASpG,EAAOU,MAAMC,SAAUgC,EAAKgD,YAAYzC,aACzElD,EAAOU,MAAMC,SAASkB,KAAKc,EAAKgD,YAAYzC,YAE7CpD,EAAS,WAAWgE,SACnB5C,QAAS,oBACTC,MAAO,mBACPwB,MACC0D,SAAU1D,EAAKkD,OAAO3C,WACtBoD,QAASxG,EAAS,WAAWoD,aAC7BvB,UAAWgB,EAAKhB,cAInB4E,wBAAyB,SAA8B5D,GACtD3C,EAAOU,MAAMC,SAAWf,EAAS,WAAW4G,QAAQxG,EAAOU,MAAMC,SAAUgC,EAAKkD,OAAO3C,aACvF,EAAIlD,EAAO+B,aACVJ,UAAWgB,EAAKkD,OAAOY,cACvBvD,WAAYP,EAAKkD,OAAO3C,WACxBsC,aAAa,KAGfkB,qBAAsB,SAA2B/D,GAChD,GAAIkC,GAAMlC,EAAKgD,YAAYnE,UACvB,EAAItB,EAASkB,eAAeyD,EAAI3D,QAAS2D,EAAI1D,MAAO,QACvD0D,EAAI8B,WAAahE,EAAKgD,YAAYzC,WAClCpD,EAAS,WAAWgE,QAAQe,KAG9B+B,oBAAqB,SAA0BjE,GAC9C/C,EAAS,WAAW8B,KAAKiB,EAAKgD,YAAYpF,aAAc,SAAUsG,GACjEtH,EAAeK,EAAS,WAAWkH,UAAWnE,GAC7CgD,YAAakB,QAMjBrJ,GAAQgD,SAAWA,GAgBd,SAAU/C,EAAQD,EAASS,GAUhC,QAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GAmBzF,QAASoC,GAAUb,GAClBA,EAAWN,EAAS,WAAWmH,QAAQ7G,GAAYA,GAAYA,GAC/DN,EAAS,WAAW8B,KAAKxB,EAAU,SAAU8G,GAC5CA,EAAOC,UAAYD,EAAOC,WAAajH,EAAOU,MAAMwE,QAAQQ,gBAC5D9F,EAAS,WAAW8B,KAA0B,SAArBsF,EAAOC,WAAwB,KAAM,QAAUD,EAAOC,WAAY,SAAUC,GAC/FpG,EAAQoG,GAAKF,EAAO9F,SAEbtB,EAAS,WAAWuH,QAAQrG,EAAQoG,GAAKF,EAAO9F,SAAU8F,EAAO7F,QAC5EL,EAAQoG,GAAKF,EAAO9F,SAASW,KAAKmF,EAAO7F,OAFzCL,EAAQoG,GAAKF,EAAO9F,UAAY8F,EAAO7F,WAQ3C,QAASH,GAAad,GACrBA,EAAWN,EAAS,WAAWmH,QAAQ7G,GAAYA,GAAYA,GAC/DN,EAAS,WAAW8B,KAAKxB,EAAU,SAAU8G,GAC5CA,EAAOC,UAAYD,EAAOC,WAAajH,EAAOU,MAAMwE,QAAQQ,gBAC5D9F,EAAS,WAAW8B,KAA0B,SAArBsF,EAAOC,WAAwB,KAAM,QAAUD,EAAOC,WAAY,SAAUC,GAChGpG,EAAQoG,GAAKF,EAAO9F,UAAYtB,EAAS,WAAWuH,QAAQrG,EAAQoG,GAAKF,EAAO9F,SAAU8F,EAAO7F,SACpGL,EAAQoG,GAAKF,EAAO9F,SAAWtB,EAAS,WAAW4G,QAAQ1F,EAAQoG,GAAKF,EAAO9F,SAAU8F,EAAO7F,YAMpG,QAASC,GAAcF,EAASC,EAAO8F,GACtC,GAAIG,GAAiB5H,OAAO0E,UAAUC,eAAe7F,KAAKwC,EAAQmG,GAAY/F,GAC1EmG,EAAaD,GAAkBxH,EAAS,WAAW0H,KAAKxG,EAAQmG,GAAW/F,GAAU,SAAUqG,GAClG,MAAOzH,GAAS,WAAW+C,cAAc2E,SAASC,QAAQF,EAASpG,KAEhEuG,EAAmD,cAApC1H,EAAOU,MAAMwE,QAAQF,UACxC,OAAOhF,GAAOU,MAAMwE,QAAQO,UAAYiC,KAAkBN,GAAkBA,IAAmBC,KAAgBK,GAAgBN,GAAkBC,GA3DlJ7H,OAAOC,eAAejC,EAAS,cAC9BkC,OAAO,IAERlC,EAAQuD,UAAYA,EACpBvD,EAAQwD,aAAeA,EACvBxD,EAAQ4D,cAAgBA,CAKxB,IAAIzB,GAAU1B,EAAoB,GAE9B2B,EAAWlB,EAAuBiB,GAElCK,EAAS/B,EAAoB,GAE7B4B,EAAU5B,EAAoB,GAE9B6B,EAAWpB,EAAuBmB,GAElCiB,GACH6G,QACAC,OAGDpK,GAAQ,WAAasD,GAuChB,SAAUrD,EAAQD,EAASS,GAWhC,QAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GAIzF,QAASkJ,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAbhHxI,OAAOC,eAAejC,EAAS,cAC9BkC,OAAO,GAIR,IAAIuI,GAAe,WAAe,QAASC,GAAiB9F,EAAQ+F,GAAS,IAAK,GAAI7E,GAAI,EAAGA,EAAI6E,EAAM5F,OAAQe,IAAK,CAAE,GAAI8E,GAAaD,EAAM7E,EAAI8E,GAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,SAAWF,KAAYA,EAAWG,UAAW,GAAM/I,OAAOC,eAAe2C,EAAQgG,EAAWI,IAAKJ,IAAiB,MAAO,UAAUL,EAAaU,EAAYC,GAAiJ,MAA9HD,IAAYP,EAAiBH,EAAY7D,UAAWuE,GAAiBC,GAAaR,EAAiBH,EAAaW,GAAqBX,MAU7hBhI,EAAgB9B,EAAoB,GAEpCgC,EAAYhC,EAAoB,GAEhC+B,EAAS/B,EAAoB,GAE7B4B,EAAU5B,EAAoB,GAE9B6B,EAAWpB,EAAuBmB,GAElCF,EAAU1B,EAAoB,GAE9B2B,EAAWlB,EAAuBiB,GAElCW,EAAmB,WACtB,QAASA,GAAiB8B,EAAQiD,EAASnC,GAC1C2E,EAAgBhK,KAAMyC,GAEtBzC,KAAKuE,OAASA,EACdvE,KAAKwH,QAAUA,MACfxH,KAAKsI,SACLtI,KAAKqF,WAAaA,EAClBrF,KAAKkI,mBAAoB,EAkF1B,MA/EAkC,GAAa3H,IACZkI,IAAK,WACL9I,MAAO,SAAkB2C,GACxB,GAAIsD,IAAc,EAAI5F,EAAcuB,gBAAgB,OACpDzD,MAAKsI,MAAMR,EAAYlB,SACtBA,OAAQkB,EAAYlB,OACpBpC,SAAUA,GAAYrC,EAAOwC,OAE9B3E,KAAKuB,KAAKuG,MAGX6C,IAAK,WACL9I,MAAO,SAAkBiJ,GACxB9K,KAAKuB,MAAK,EAAIW,EAAcuB,gBAAgB,OAAQqH,OAGrDH,IAAK,aACL9I,MAAO,SAAoBkJ,GAC1B/K,KAAKuB,MAAK,EAAIW,EAAcuB,gBAAgB,SAAUsH,OAGvDJ,IAAK,cACL9I,MAAO,SAAqB8B,GAC3B,GAAK3D,KAAKkI,kBAAV,CAGAvE,EAASqH,SAAWrH,EAASqH,UAAY/I,EAAS,WAAWoD,YAC7D,IAAI2B,GAAMjF,EAAS,WAAWkJ,MAAMtH,IAChC3D,KAAKqF,YAAcrF,KAAKqF,aAAe2B,EAAI8B,YAAgB9B,EAAIkE,UAAalE,EAAIkE,SAASxG,UAAUsC,EAAIkE,UAAanJ,EAAS,WAAWuH,QAAQtC,EAAIkE,SAAUlL,KAAKqF,eACtK2B,EAAIkE,UAAYlE,EAAIkE,cAAgBC,OAAOpJ,EAAS,WAAW4G,QAAQxG,EAAOU,MAAMC,SAAU9C,KAAKqF,aACnGrF,KAAKuB,MAAK,EAAIW,EAAcuB,gBAAgB,UAAWuD,SAIzD2D,IAAK,aACL9I,MAAO,WACN7B,KAAKuB,MAAK,EAAIW,EAAcuB,gBAAgB,kBAG7CkH,IAAK,YACL9I,MAAO,SAAmBiG,GACrB9H,KAAKoL,kBACR,EAAIhJ,EAAUV,iBACboC,UAAW9D,KAAK4I,cAChBd,YAAaA,EACbE,OAAQhI,UAKX2K,IAAK,gBACL9I,MAAO,WACN,OAAO,KAGR8I,IAAK,OACL9I,MAAO,WACN,KAAM,IAAIuF,OAAM,0FAGjBuD,IAAK,gBACL9I,MAAO,SAAuBtB,GAC7BP,KAAKqF,WAAa9E,OAGnBoK,IAAK,SACL9I,MAAO,SAAgByI,EAAOe,GAC7B,QAASC,KACR7I,EAAiBpB,MAAMrB,KAAMiE,WAO9B,MAJAqH,GAAWjF,UAAY1E,OAAO4J,OAAO9I,EAAiB4D,WACtDtE,EAAS,WAAWkH,OAAOqC,EAAWjF,UAAWiE,GACjDvI,EAAS,WAAWkH,OAAOqC,EAAYD,GAEhCC,MAIF7I,IAGR9C,GAAQ,WAAa8C,EACrB7C,EAAOD,QAAUA,EAAQ","file":"postal.federation.min.js","sourcesContent":["/*!\n *  * postal.federation - A base plugin for federating instances of postal.js across various boundaries.\n *  * Author: Jim Cowart (http://ifandelse.com)\n *  * Version: v0.5.4\n *  * Url: http://github.com/postaljs/postal.federation\n *  * License(s): (MIT OR GPL-2.0)\n */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"postal\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"lodash\", \"postal\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"postalFedx\"] = factory(require(\"lodash\"), require(\"postal\"));\n\telse\n\t\troot[\"postalFedx\"] = factory(root[\"_\"], root[\"postal\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t// istanbul ignore next\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\t\n\tvar _lodash = __webpack_require__(1);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar _postal = __webpack_require__(2);\n\t\n\tvar _postal2 = _interopRequireDefault(_postal);\n\t\n\t__webpack_require__(3);\n\t\n\tvar _packingSlips = __webpack_require__(4);\n\t\n\tvar _state = __webpack_require__(5);\n\t\n\tvar _handlers = __webpack_require__(6);\n\t\n\tvar _filters = __webpack_require__(7);\n\t\n\tvar _filters2 = _interopRequireDefault(_filters);\n\t\n\tvar _FederationClient = __webpack_require__(8);\n\t\n\tvar _FederationClient2 = _interopRequireDefault(_FederationClient);\n\t\n\tvar fedx = _postal2[\"default\"].fedx = {\n\t\tFederationClient: _FederationClient2[\"default\"],\n\t\tpackingSlips: _packingSlips.packingSlips,\n\t\thandlers: _handlers.handlers,\n\t\tclients: _state.state._clients,\n\t\ttransports: _state.state._transports,\n\t\tfilters: _filters2[\"default\"],\n\t\taddFilter: _filters.addFilter,\n\t\tremoveFilter: _filters.removeFilter,\n\t\tcanSendRemote: function canSendRemote(channel, topic) {\n\t\t\treturn (0, _filters.matchesFilter)(channel, topic, \"out\");\n\t\t},\n\t\tconfigure: _state.configure,\n\t\tgetPackingSlip: _packingSlips.getPackingSlip,\n\t\tonFederatedMsg: _handlers.onFederatedMsg,\n\t\tsendMessage: function sendMessage(envelope) {\n\t\t\tif (!_state.state._ready) {\n\t\t\t\t_state.state._outboundQueue.push(arguments);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t_lodash2[\"default\"].each(this.transports, function (transport) {\n\t\t\t\ttransport.sendMessage(envelope);\n\t\t\t});\n\t\t},\n\t\tdisconnect: _state.disconnect,\n\t\t_getTransports: function _getTransports() {\n\t\t\treturn _lodash2[\"default\"].reduce(this.transports, function (memo, transport, name) {\n\t\t\t\tmemo[name] = true;\n\t\t\t\treturn memo;\n\t\t\t}, {});\n\t\t},\n\t\t/*\n\t \tsignalReady( callback );\n\t \tsignalReady( \"transportName\" );\n\t \tsignalReady( \"transportName\", callback );\n\t \tsignalReady( \"transportName\", targetInstance, callback ); <-- this is NEW\n\t \tsignalReady( { transportNameA: targetsForA, transportNameB: targetsForB, transportC: true }, callback);\n\t */\n\t\tsignalReady: function signalReady(transport, target, callback) {\n\t\t\tif (!_state.state._ready) {\n\t\t\t\t_state.state._signalQueue.push(arguments);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar transports = this._getTransports();\n\t\t\tswitch (arguments.length) {\n\t\t\t\tcase 1:\n\t\t\t\t\tif (typeof transport === \"function\") {\n\t\t\t\t\t\tcallback = transport;\n\t\t\t\t\t} else if (typeof transport === \"string\") {\n\t\t\t\t\t\ttransports = {};\n\t\t\t\t\t\ttransports[transport] = this.transports[transport];\n\t\t\t\t\t\tcallback = _state.NO_OP;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tif (typeof transport === \"string\") {\n\t\t\t\t\t\ttransports = {};\n\t\t\t\t\t\ttransports[transport] = this.transports[transport];\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttransports = transport;\n\t\t\t\t\t}\n\t\t\t\t\tcallback = target || _state.NO_OP;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\ttransports = {};\n\t\t\t\t\ttransports[transport] = [target];\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t_lodash2[\"default\"].each(transports, function (targets, name) {\n\t\t\t\ttargets = typeof targets === \"boolean\" ? [] : targets;\n\t\t\t\tthis.transports[name].signalReady(targets, callback);\n\t\t\t}, this);\n\t\t}\n\t};\n\t\n\texports[\"default\"] = fedx;\n\t\n\tfunction processSignalQ(args) {\n\t\tfedx.signalReady.apply(this, args);\n\t}\n\t\n\tfunction processOutboundQ(args) {\n\t\tfedx.send.apply(this, args);\n\t}\n\t\n\tfunction processInboundQ(msg) {\n\t\tfedx.onFederatedMsg.call(this, msg);\n\t}\n\t\n\t_postal2[\"default\"].addWireTap(function (data, envelope) {\n\t\tif (fedx.canSendRemote(envelope.channel, envelope.topic)) {\n\t\t\tfedx.sendMessage(envelope);\n\t\t}\n\t});\n\t\n\t_postal2[\"default\"].subscribe({\n\t\tchannel: _postal2[\"default\"].configuration.SYSTEM_CHANNEL,\n\t\ttopic: \"instanceId.changed\",\n\t\tcallback: function callback() {\n\t\t\t_state.state._ready = true;\n\t\t\twhile (_state.state._signalQueue.length) {\n\t\t\t\tprocessSignalQ(_state.state._signalQueue.shift());\n\t\t\t}\n\t\t\twhile (_state.state._outboundQueue.length) {\n\t\t\t\tprocessOutboundQ(_state.state._outboundQueue.shift());\n\t\t\t}\n\t\t\twhile (_state.state._inboundQueue.length) {\n\t\t\t\tprocessInboundQ(_state.state._inboundQueue.shift());\n\t\t\t}\n\t\t}\n\t});\n\t\n\tif (_postal2[\"default\"].instanceId() !== undefined) {\n\t\t_state.state._ready = true;\n\t}\n\tmodule.exports = exports[\"default\"];\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// istanbul ignore next\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\t\n\tvar _postal = __webpack_require__(2);\n\t\n\tvar _postal2 = _interopRequireDefault(_postal);\n\t\n\tif (!_postal2[\"default\"].createUUID) {\n\t\t_postal2[\"default\"].createUUID = function () {\n\t\t\tvar s = [];\n\t\t\tvar hexDigits = \"0123456789abcdef\";\n\t\t\tfor (var i = 0; i < 36; i++) {\n\t\t\t\ts[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n\t\t\t}\n\t\t\ts[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n\t\t\t/* jshint ignore:start */\n\t\t\ts[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n\t\t\t/* jshint ignore:end */\n\t\t\ts[8] = s[13] = s[18] = s[23] = \"-\";\n\t\t\treturn s.join(\"\");\n\t\t};\n\t}\n\tif (!_postal2[\"default\"].instanceId) {\n\t\t_postal2[\"default\"].instanceId = (function () {\n\t\t\tvar _id = undefined,\n\t\t\t    _oldId = undefined;\n\t\t\treturn function (id) {\n\t\t\t\tif (id) {\n\t\t\t\t\t_oldId = _id;\n\t\t\t\t\t_id = id;\n\t\t\t\t\t_postal2[\"default\"].publish({\n\t\t\t\t\t\tchannel: _postal2[\"default\"].configuration.SYSTEM_CHANNEL,\n\t\t\t\t\t\ttopic: \"instanceId.changed\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\toldId: _oldId,\n\t\t\t\t\t\t\tnewId: _id\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn _id;\n\t\t\t};\n\t\t})();\n\t}\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.getPackingSlip = getPackingSlip;\n\t// istanbul ignore next\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\t\n\tvar _postal = __webpack_require__(2);\n\t\n\tvar _postal2 = _interopRequireDefault(_postal);\n\t\n\tfunction getPackingSlip(type /*, env */) {\n\t\tif (Object.prototype.hasOwnProperty.call(packingSlips, type)) {\n\t\t\treturn packingSlips[type].apply(this, Array.prototype.slice.call(arguments, 1));\n\t\t}\n\t}\n\t\n\tvar packingSlips = {\n\t\tping: function ping() {\n\t\t\treturn {\n\t\t\t\ttype: \"federation.ping\",\n\t\t\t\tinstanceId: _postal2[\"default\"].instanceId(),\n\t\t\t\ttimeStamp: new Date(),\n\t\t\t\tticket: _postal2[\"default\"].createUUID()\n\t\t\t};\n\t\t},\n\t\tpong: function pong(ping) {\n\t\t\treturn {\n\t\t\t\ttype: \"federation.pong\",\n\t\t\t\tinstanceId: _postal2[\"default\"].instanceId(),\n\t\t\t\ttimeStamp: new Date(),\n\t\t\t\tpingData: {\n\t\t\t\t\tinstanceId: ping.instanceId,\n\t\t\t\t\ttimeStamp: ping.timeStamp,\n\t\t\t\t\tticket: ping.ticket\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tmessage: function message(env) {\n\t\t\treturn {\n\t\t\t\ttype: \"federation.message\",\n\t\t\t\tinstanceId: _postal2[\"default\"].instanceId(),\n\t\t\t\ttimeStamp: new Date(),\n\t\t\t\tenvelope: env\n\t\t\t};\n\t\t},\n\t\tdisconnect: function disconnect() {\n\t\t\treturn {\n\t\t\t\ttype: \"federation.disconnect\",\n\t\t\t\tinstanceId: _postal2[\"default\"].instanceId(),\n\t\t\t\ttimeStamp: new Date()\n\t\t\t};\n\t\t},\n\t\tbundle: function bundle(packingSlips) {\n\t\t\treturn {\n\t\t\t\ttype: \"federation.bundle\",\n\t\t\t\tinstanceId: _postal2[\"default\"].instanceId(),\n\t\t\t\ttimeStamp: new Date(),\n\t\t\t\tpackingSlips: packingSlips\n\t\t\t};\n\t\t}\n\t};\n\texports.packingSlips = packingSlips;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.configure = configure;\n\texports.disconnect = disconnect;\n\t// istanbul ignore next\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\t\n\tvar _lodash = __webpack_require__(1);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar _defaults = {\n\t\tenabled: true,\n\t\tfilterMode: \"whitelist\",\n\t\tfilterDirection: \"both\"\n\t};\n\t\n\tvar NO_OP = function NO_OP() {};\n\t\n\texports.NO_OP = NO_OP;\n\tvar state = {\n\t\t_clients: [],\n\t\t_transports: {},\n\t\t_ready: false,\n\t\t_inboundQueue: [],\n\t\t_outboundQueue: [],\n\t\t_signalQueue: [],\n\t\t_config: _defaults\n\t};\n\t\n\texports.state = state;\n\t\n\tfunction configure(cfg) {\n\t\tif (cfg && cfg.filterMode && cfg.filterMode !== \"blacklist\" && cfg.filterMode !== \"whitelist\") {\n\t\t\tthrow new Error(\"postal.fedx filterMode must be 'blacklist' or 'whitelist'.\");\n\t\t}\n\t\tif (cfg) {\n\t\t\tstate._config = _lodash2[\"default\"].defaults(cfg, _defaults);\n\t\t}\n\t\treturn state._config;\n\t}\n\t\n\tfunction disconnect(options) {\n\t\toptions = options || {};\n\t\tvar trans = state._transports;\n\t\tif (options.transport) {\n\t\t\ttrans = {};\n\t\t\ttrans[options.transport] = state._transports[options.transport];\n\t\t}\n\t\t_lodash2[\"default\"].each(trans, function (t) {\n\t\t\tt.disconnect({\n\t\t\t\ttarget: options.target,\n\t\t\t\tinstanceId: options.instanceId,\n\t\t\t\tdoNotNotify: !!options.doNotNotify\n\t\t\t});\n\t\t});\n\t}\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.onFederatedMsg = onFederatedMsg;\n\t// istanbul ignore next\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\t\n\tvar _packingSlips = __webpack_require__(4);\n\t\n\tvar _state = __webpack_require__(5);\n\t\n\tvar _filters = __webpack_require__(7);\n\t\n\tvar _postal = __webpack_require__(2);\n\t\n\tvar _postal2 = _interopRequireDefault(_postal);\n\t\n\tvar _lodash = __webpack_require__(1);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar handlers = {\n\t\t\"federation.ping\": function federationPing(data /*, callback */) {\n\t\t\tdata.source.setInstanceId(data.packingSlip.instanceId);\n\t\t\tif (data.source.handshakeComplete) {\n\t\t\t\tdata.source.sendPong(data.packingSlip);\n\t\t\t} else {\n\t\t\t\tdata.source.sendBundle([(0, _packingSlips.getPackingSlip)(\"pong\", data.packingSlip), (0, _packingSlips.getPackingSlip)(\"ping\")]);\n\t\t\t}\n\t\t},\n\t\t\"federation.pong\": function federationPong(data) {\n\t\t\tdata.source.handshakeComplete = true;\n\t\t\tdata.source.setInstanceId(data.packingSlip.instanceId);\n\t\t\tif (data.source.pings[data.packingSlip.pingData.ticket]) {\n\t\t\t\tdata.source.pings[data.packingSlip.pingData.ticket].callback({\n\t\t\t\t\tticket: data.packingSlip.pingData.ticket,\n\t\t\t\t\tinstanceId: data.packingSlip.instanceId,\n\t\t\t\t\tsource: data.source\n\t\t\t\t});\n\t\t\t\tdata.source.pings[data.packingSlip.pingData.ticket] = undefined;\n\t\t\t}\n\t\t\tif (!_lodash2[\"default\"].includes(_state.state._clients, data.packingSlip.instanceId)) {\n\t\t\t\t_state.state._clients.push(data.packingSlip.instanceId);\n\t\t\t}\n\t\t\t_postal2[\"default\"].publish({\n\t\t\t\tchannel: \"postal.federation\",\n\t\t\t\ttopic: \"client.federated\",\n\t\t\t\tdata: {\n\t\t\t\t\tremoteId: data.source.instanceId,\n\t\t\t\t\tlocalId: _postal2[\"default\"].instanceId(),\n\t\t\t\t\ttransport: data.transport\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\"federation.disconnect\": function federationDisconnect(data) {\n\t\t\t_state.state._clients = _lodash2[\"default\"].without(_state.state._clients, data.source.instanceId);\n\t\t\t(0, _state.disconnect)({\n\t\t\t\ttransport: data.source.transportName,\n\t\t\t\tinstanceId: data.source.instanceId,\n\t\t\t\tdoNotNotify: true\n\t\t\t});\n\t\t},\n\t\t\"federation.message\": function federationMessage(data) {\n\t\t\tvar env = data.packingSlip.envelope;\n\t\t\tif ((0, _filters.matchesFilter)(env.channel, env.topic, \"in\")) {\n\t\t\t\tenv.lastSender = data.packingSlip.instanceId;\n\t\t\t\t_postal2[\"default\"].publish(env);\n\t\t\t}\n\t\t},\n\t\t\"federation.bundle\": function federationBundle(data) {\n\t\t\t_lodash2[\"default\"].each(data.packingSlip.packingSlips, function (slip) {\n\t\t\t\tonFederatedMsg(_lodash2[\"default\"].extend({}, data, {\n\t\t\t\t\tpackingSlip: slip\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t};\n\t\n\texports.handlers = handlers;\n\t\n\tfunction onFederatedMsg(data) {\n\t\tif (!_state.state._ready) {\n\t\t\t_state.state._inboundQueue.push(data);\n\t\t\treturn;\n\t\t}\n\t\tif (Object.prototype.hasOwnProperty.call(handlers, data.packingSlip.type)) {\n\t\t\thandlers[data.packingSlip.type](data);\n\t\t} else {\n\t\t\tthrow new Error(\"postal.federation does not have a message handler for '\" + data.packingSlip.type + \"'.\");\n\t\t}\n\t}\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.addFilter = addFilter;\n\texports.removeFilter = removeFilter;\n\texports.matchesFilter = matchesFilter;\n\t// istanbul ignore next\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\t\n\tvar _lodash = __webpack_require__(1);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar _state = __webpack_require__(5);\n\t\n\tvar _postal = __webpack_require__(2);\n\t\n\tvar _postal2 = _interopRequireDefault(_postal);\n\t\n\tvar filters = {\n\t\t\"in\": {}, // jscs:ignore disallowQuotedKeysInObjects\n\t\tout: {}\n\t};\n\t\n\texports[\"default\"] = filters;\n\t\n\tfunction addFilter(_filters) {\n\t\t_filters = _lodash2[\"default\"].isArray(_filters) ? _filters : [_filters];\n\t\t_lodash2[\"default\"].each(_filters, function (filter) {\n\t\t\tfilter.direction = filter.direction || _state.state._config.filterDirection;\n\t\t\t_lodash2[\"default\"].each(filter.direction === \"both\" ? [\"in\", \"out\"] : [filter.direction], function (dir) {\n\t\t\t\tif (!filters[dir][filter.channel]) {\n\t\t\t\t\tfilters[dir][filter.channel] = [filter.topic];\n\t\t\t\t} else if (!_lodash2[\"default\"].include(filters[dir][filter.channel], filter.topic)) {\n\t\t\t\t\tfilters[dir][filter.channel].push(filter.topic);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\t\n\tfunction removeFilter(_filters) {\n\t\t_filters = _lodash2[\"default\"].isArray(_filters) ? _filters : [_filters];\n\t\t_lodash2[\"default\"].each(_filters, function (filter) {\n\t\t\tfilter.direction = filter.direction || _state.state._config.filterDirection;\n\t\t\t_lodash2[\"default\"].each(filter.direction === \"both\" ? [\"in\", \"out\"] : [filter.direction], function (dir) {\n\t\t\t\tif (filters[dir][filter.channel] && _lodash2[\"default\"].include(filters[dir][filter.channel], filter.topic)) {\n\t\t\t\t\tfilters[dir][filter.channel] = _lodash2[\"default\"].without(filters[dir][filter.channel], filter.topic);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\t\n\tfunction matchesFilter(channel, topic, direction) {\n\t\tvar channelPresent = Object.prototype.hasOwnProperty.call(filters[direction], channel);\n\t\tvar topicMatch = channelPresent && _lodash2[\"default\"].some(filters[direction][channel], function (binding) {\n\t\t\treturn _postal2[\"default\"].configuration.resolver.compare(binding, topic);\n\t\t});\n\t\tvar blacklisting = _state.state._config.filterMode === \"blacklist\";\n\t\treturn _state.state._config.enabled && (blacklisting && (!channelPresent || channelPresent && !topicMatch) || !blacklisting && channelPresent && topicMatch);\n\t}\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t// istanbul ignore next\n\t\n\tvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\t\n\t// istanbul ignore next\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\t\n\t// istanbul ignore next\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar _packingSlips = __webpack_require__(4);\n\t\n\tvar _handlers = __webpack_require__(6);\n\t\n\tvar _state = __webpack_require__(5);\n\t\n\tvar _postal = __webpack_require__(2);\n\t\n\tvar _postal2 = _interopRequireDefault(_postal);\n\t\n\tvar _lodash = __webpack_require__(1);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar FederationClient = (function () {\n\t\tfunction FederationClient(target, options, instanceId) {\n\t\t\t_classCallCheck(this, FederationClient);\n\t\n\t\t\tthis.target = target;\n\t\t\tthis.options = options || {};\n\t\t\tthis.pings = {};\n\t\t\tthis.instanceId = instanceId;\n\t\t\tthis.handshakeComplete = false;\n\t\t}\n\t\n\t\t_createClass(FederationClient, [{\n\t\t\tkey: \"sendPing\",\n\t\t\tvalue: function sendPing(callback) {\n\t\t\t\tvar packingSlip = (0, _packingSlips.getPackingSlip)(\"ping\");\n\t\t\t\tthis.pings[packingSlip.ticket] = {\n\t\t\t\t\tticket: packingSlip.ticket,\n\t\t\t\t\tcallback: callback || _state.NO_OP\n\t\t\t\t};\n\t\t\t\tthis.send(packingSlip);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sendPong\",\n\t\t\tvalue: function sendPong(origPackingSlip) {\n\t\t\t\tthis.send((0, _packingSlips.getPackingSlip)(\"pong\", origPackingSlip));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sendBundle\",\n\t\t\tvalue: function sendBundle(slips) {\n\t\t\t\tthis.send((0, _packingSlips.getPackingSlip)(\"bundle\", slips));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sendMessage\",\n\t\t\tvalue: function sendMessage(envelope) {\n\t\t\t\tif (!this.handshakeComplete) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tenvelope.originId = envelope.originId || _postal2[\"default\"].instanceId();\n\t\t\t\tvar env = _lodash2[\"default\"].clone(envelope);\n\t\t\t\tif (this.instanceId && this.instanceId !== env.lastSender && (!env.knownIds || !env.knownIds.length || env.knownIds && !_lodash2[\"default\"].include(env.knownIds, this.instanceId))) {\n\t\t\t\t\tenv.knownIds = (env.knownIds || []).concat(_lodash2[\"default\"].without(_state.state._clients, this.instanceId));\n\t\t\t\t\tthis.send((0, _packingSlips.getPackingSlip)(\"message\", env));\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"disconnect\",\n\t\t\tvalue: function disconnect() {\n\t\t\t\tthis.send((0, _packingSlips.getPackingSlip)(\"disconnect\"));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"onMessage\",\n\t\t\tvalue: function onMessage(packingSlip) {\n\t\t\t\tif (this.shouldProcess()) {\n\t\t\t\t\t(0, _handlers.onFederatedMsg)({\n\t\t\t\t\t\ttransport: this.transportName,\n\t\t\t\t\t\tpackingSlip: packingSlip,\n\t\t\t\t\t\tsource: this\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"shouldProcess\",\n\t\t\tvalue: function shouldProcess() {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"send\",\n\t\t\tvalue: function send() /* msg */{\n\t\t\t\tthrow new Error(\"An object deriving from FederationClient must provide an implementation for 'send'.\");\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"setInstanceId\",\n\t\t\tvalue: function setInstanceId(id) {\n\t\t\t\tthis.instanceId = id;\n\t\t\t}\n\t\t}], [{\n\t\t\tkey: \"extend\",\n\t\t\tvalue: function extend(props, ctrProps) {\n\t\t\t\tfunction FedXClient() {\n\t\t\t\t\tFederationClient.apply(this, arguments);\n\t\t\t\t}\n\t\n\t\t\t\tFedXClient.prototype = Object.create(FederationClient.prototype);\n\t\t\t\t_lodash2[\"default\"].extend(FedXClient.prototype, props);\n\t\t\t\t_lodash2[\"default\"].extend(FedXClient, ctrProps);\n\t\n\t\t\t\treturn FedXClient;\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn FederationClient;\n\t})();\n\t\n\texports[\"default\"] = FederationClient;\n\tmodule.exports = exports[\"default\"];\n\n/***/ })\n/******/ ])\n});\n;"]}